BEGIN TRAN



INSERT INTO rev.EPC_CRS_LEVEL_LST
SELECT
	NEWID() AS [COURSE_LEVEL_LST_GU]
	,[COURSE_LIST].[COURSE_GU]
	,'D' AS [COURSE_LEVEL]
FROM
	(
	SELECT
		[COURSE].[COURSE_GU]
		--,[COURSE].[COURSE_ID]
		--,[COURSE].[STATE_COURSE_CODE]
		--,[COURSE].[COURSE_TITLE]
		--,[COURSE].[DEPARTMENT]
		--,[COURSE].[SUBJECT_AREA_1]
		--,[COURSE].[SUBJECT_AREA_2]
		--,[COURSE].[SUBJECT_AREA_3]
		--,[COURSE].[TECHNICAL_PROVIDER]
		--,[COURSE].[OTHER_PROVIDER_NAME]
		--,[COURSE].[DUAL_CREDIT]
		--,[COURSE_LEVEL].*
		
	FROM
		rev.EPC_CRS AS [COURSE]
		
		LEFT OUTER JOIN
		(
		SELECT
			[LIST_PIVOT].*		
		FROM
			(
			SELECT
				[COURSE_GU]
				,[COURSE_LEVEL]
			FROM
				rev.EPC_CRS_LEVEL_LST 
			) [LIST]
			PIVOT (MIN([COURSE_LEVEL]) FOR [COURSE_LEVEL] IN ([N],[H],[A],[D],[L],[G],[GFT],[C]) ) AS [LIST_PIVOT]
		)AS [COURSE_LEVEL]
		ON
		[COURSE].[COURSE_GU] = [COURSE_LEVEL].[COURSE_GU]
		
	WHERE
		[COURSE].[DUAL_CREDIT] = 'Y'
		AND ([COURSE_LEVEL].[D] IS NULL)
	) AS [COURSE_LIST]
	
--ROLLBACK
COMMIT