



DECLARE @SCHOOL_YEAR INT = 2014

SELECT 
	[STUDENT].[SIS_NUMBER]
	,[STUDENT].[FIRST_NAME]
	,[STUDENT].[LAST_NAME]
	,[STUDENT].[MIDDLE_NAME]	
	,[COURSE_HISTORY].[COURSE_ID]
	,[COURSE_HISTORY].[COURSE_TITLE]
	,CASE WHEN [Organization].[ORGANIZATION_NAME] IS NULL THEN 'NON APS LOCATION' ELSE [Organization].[ORGANIZATION_NAME] END AS [COURSE_LOCATION]
	,[Grades].[VALUE_DESCRIPTION] AS [GRADE_IN_YEAR]
	,[COURSE_HISTORY].[SCHOOL_YEAR]
	,[COURSE_HISTORY].[TERM_CODE]
	,[COURSE_HISTORY].[MARK]
	,[COURSE_HISTORY].[CREDIT_COMPLETED]
	
	--,[COURSE_HISTORY].*
FROM
	(
	SELECT DISTINCT
		[SCHEDULE].[STUDENT_GU]
	FROM
		-- Get full schedule
		APS.BasicSchedule AS [SCHEDULE]
		
		INNER JOIN
		-- Get Course details
		rev.EPC_CRS AS [COURSE]
		ON
		[SCHEDULE].[COURSE_GU] = [COURSE].[COURSE_GU]
		
		INNER JOIN 
		rev.REV_YEAR AS [RevYear] -- Contains the School Year
		ON 
		[SCHEDULE].[YEAR_GU] = [RevYear].[YEAR_GU]
		
	WHERE
		[COURSE].[COURSE_ID] IN ('55507','555071','555072','55508','555081','555082','555091','555092','555101','555102','555111','555112','555121','555122')
		AND [SCHEDULE].[ORGANIZATION_GU] LIKE @School
		AND [SCHEDULE].[YEAR_GU] LIKE @Year
		
	) AS [AVID_STUDENTS]
	
	INNER JOIN
	rev.[EPC_STU_CRS_HIS] AS [COURSE_HISTORY]
	ON
	[AVID_STUDENTS].[STUDENT_GU] = [COURSE_HISTORY].[STUDENT_GU]
	
	INNER JOIN
	APS.BasicStudent AS [STUDENT]
	ON
	[AVID_STUDENTS].[STUDENT_GU] = [STUDENT].[STUDENT_GU]
	
	LEFT OUTER JOIN
	rev.REV_ORGANIZATION AS [Organization] -- Contains the School Name
	ON 
	[COURSE_HISTORY].[SCHOOL_IN_DISTRICT_GU] = [Organization].[ORGANIZATION_GU]
	
	LEFT OUTER JOIN
	APS.LookupTable('K12','Grade') AS [Grades]
	ON
	[COURSE_HISTORY].[GRADE] = [Grades].[VALUE_CODE]