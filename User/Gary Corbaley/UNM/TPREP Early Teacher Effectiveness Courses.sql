



SELECT
	[STUDENT].[SIS_NUMBER]
	--,[STUDENT].[STATE_STUDENT_NUMBER]
	--,[ENROLLMENTS].[SCHOOL_YEAR]
	--,[STUDENT].[BIRTH_DATE]
	--,[ENROLLMENTS].[GRADE]
	--,[STUDENT].[GENDER]
	--,[STUDENT].[HISPANIC_INDICATOR]
	--,[STUDENT].[RACE_1]
	--,[STUDENT].[RACE_2]
	--,[STUDENT].[RACE_3]
	--,[STUDENT].[RACE_4]
	--,[STUDENT].[RACE_5]
	--,[STUDENT].[RESOLVED_RACE]
	--,[STUDENT].[LUNCH_STATUS]
	--,[STUDENT].[ELL_STATUS]
	--,[STUDENT].[PRIMARY_DISABILITY_CODE]
	,[STAFF].[BADGE_NUM]
	,[STAFF_PERSON].[FIRST_NAME] + ' ' + [STAFF_PERSON].[LAST_NAME] AS [TEACHER_NAME]
	,[SECTION_STAFF].[PRIMARY_TEACHER]
	
	,[ENROLLMENTS].[SCHOOL_YEAR]
	
	,[SCHEDULE].[TERM_CODE]
	,[SCHEDULE].[COURSE_ID]
	,[SCHEDULE].[SECTION_ID]
	,[SCHEDULE].[COURSE_TITLE]
	,[SCHEDULE].[SUBJECT_AREA_1]
	,[SCHEDULE].[DEPARTMENT]
	,[ENROLLMENTS].[GRADE]
	--,CONVERT(VARCHAR,[SCHEDULE].[GRADE_RANGE_LOW]) + '-' + CONVERT(VARCHAR,[SCHEDULE].[GRADE_RANGE_HIGH]) AS [COURSE_GRADE_LEVEL]
	,[ENROLLMENTS].[SCHOOL_CODE]
	,[ENROLLMENTS].[SCHOOL_NAME]
	,[SCHEDULE].[COURSE_ENTER_DATE]
	,[SCHEDULE].[COURSE_LEAVE_DATE]
	
	--,[COURSE_GRADES].[GRADE_PERIOD]
	--,[COURSE_GRADES].[MARK]
	
	--,[HISTORY].[TERM_CODE]
	--,[HISTORY].[COURSE_ID]
	--,[HISTORY].[SECTION_ID]
	--,[HISTORY].[CLASS_BEGIN_DATE]
	--,[HISTORY].[CLASS_END_DATE]
	--,[HISTORY].[COURSE_TITLE]
	--,[COURSE].[DEPARTMENT]
	,[HISTORY].[MARK]
	--,[HISTORY].[CREDIT_COMPLETED]
	
FROM
	(
	SELECT
		*
		,ROW_NUMBER() OVER (PARTITION BY [STUDENT_GU] ORDER BY [ENTER_DATE] DESC) AS RN
	FROM
		APS.StudentEnrollmentDetails
		
	WHERE
		SCHOOL_YEAR = 2014
		AND EXTENSION = 'R'
		AND EXCLUDE_ADA_ADM IS NULL
		
	) AS [ENROLLMENTS]
	
	INNER JOIN
	APS.BasicStudentWithMoreInfo AS [STUDENT]
	ON
	[ENROLLMENTS].[STUDENT_GU] = [STUDENT].[STUDENT_GU]
	
	LEFT OUTER HASH JOIN
	(
	SELECT
		[COURSE].[COURSE_ID]
		,[COURSE].[COURSE_TITLE]		
		,[SCHEDULE].[COURSE_ENTER_DATE]
		,[SCHEDULE].[COURSE_LEAVE_DATE]
		,[SCHEDULE].[SECTION_ID]
		,[SCHEDULE].[TERM_CODE]
		--,[COURSE].[DUAL_CREDIT]
		--,[COURSE].[OTHER_PROVIDER_NAME]
		,[COURSE].[CREDIT]
		,[COURSE].[DEPARTMENT]
		,[COURSE].[SUBJECT_AREA_1]
		--,[COURSE].[SUBJECT_AREA_2]
		--,[COURSE].[SUBJECT_AREA_3]
		--,[COURSE].[SUBJECT_AREA_4]
		--,[COURSE].[SUBJECT_AREA_5]
		--,[COURSE].[GRADE_RANGE_HIGH]
		--,[COURSE].[GRADE_RANGE_LOW]
		
		--,[SCHEDULE].[DEFAULT_MINUTES_MEET]
		--,[SCHEDULE].[PERIOD_BEGIN]
		--,[SCHEDULE].[PERIOD_END]
		--,[SCHEDULE].[ROOM_GU]
		--,[SCHEDULE].[ROOM_SIMPLE]
		--,[SCHEDULE].[ENROLLMENT_ENTER_DATE]
		--,[SCHEDULE].[ENROLLMENT_LEAVE_DATE]
		--,[SCHEDULE].[ENROLLMENT_GRADE_LEVEL]
		--,[SCHEDULE].[TXP_ACK_ADD]
		--,[SCHEDULE].[TXP_ACK_DROP]
		
		,[SCHEDULE].[STUDENT_GU]
		,[SCHEDULE].[COURSE_GU]
		,[SCHEDULE].[ORGANIZATION_GU]
		,[SCHEDULE].[ORGANIZATION_YEAR_GU]
		,[SCHEDULE].[SCHOOL_YEAR_COURSE_GU]
		,[SCHEDULE].[STUDENT_SCHOOL_YEAR_GU]
		,[SCHEDULE].[SECTION_GU]
		,[SCHEDULE].[STAFF_GU]
		,[SCHEDULE].[YEAR_GU]
		
	FROM
		APS.BasicSchedule AS [SCHEDULE]
		
		INNER JOIN
		rev.EPC_CRS AS [COURSE]
		ON
		[SCHEDULE].[COURSE_GU] = [COURSE].[COURSE_GU]
	) AS [SCHEDULE]
	ON
	[ENROLLMENTS].[STUDENT_SCHOOL_YEAR_GU] = [SCHEDULE].[STUDENT_SCHOOL_YEAR_GU]
	
	LEFT JOIN
	APS.SectionsAndAllStaffAssigned AS [SECTION_STAFF]
	ON
	[SCHEDULE].[SECTION_GU] = [SECTION_STAFF].[SECTION_GU]
	
	LEFT OUTER JOIN
	rev.EPC_STAFF AS [STAFF]
	ON
	[SECTION_STAFF].[STAFF_GU] = [STAFF].[STAFF_GU]
	
	LEFT OUTER JOIN
	rev.REV_PERSON AS [STAFF_PERSON]
	ON
	[SECTION_STAFF].[STAFF_GU] = [STAFF_PERSON].[PERSON_GU]
	
	--LEFT OUTER JOIN
	--APS.StudentGrades AS [COURSE_GRADES]
	--ON
	--[SCHEDULE].[STUDENT_SCHOOL_YEAR_GU] = [COURSE_GRADES].[STUDENT_SCHOOL_YEAR_GU]
	--AND [SCHEDULE].[SECTION_GU] = [COURSE_GRADES].[SECTION_GU]
	
	LEFT OUTER HASH JOIN
	rev.EPC_STU_CRS_HIS AS [HISTORY]
	ON
	[ENROLLMENTS].[STUDENT_GU] = [HISTORY].[STUDENT_GU]
	AND [ENROLLMENTS].[ORGANIZATION_GU] = [HISTORY].[SCHOOL_IN_DISTRICT_GU]
	AND [SCHEDULE].[COURSE_ID] = [HISTORY].[COURSE_ID]
	AND [HISTORY].[SCHOOL_YEAR] = '2014'
	
	--LEFT OUTER JOIN
	--rev.EPC_CRS AS [COURSE]
	--ON
	--[HISTORY].[COURSE_ID] = [COURSE].[COURSE_ID]
	
	
	
WHERE
	[ENROLLMENTS].[RN] = 1
	AND [ENROLLMENTS].[GRADE] BETWEEN '04' AND '06'