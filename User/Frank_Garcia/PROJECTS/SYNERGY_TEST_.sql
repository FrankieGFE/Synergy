SELECT
	Student.SIS_NUMBER
	,Person.LAST_NAME
	,Person.FIRST_NAME
	,Test.TEST_NAME
	,Part.PART_DESCRIPTION
	,Score.TEST_SCORE
	--,STU_PART.PERFORMANCE_LEVEL
	,StudentTest.ADMIN_DATE
	,Org.ORGANIZATION_NAME AS CurrentYearEnrollmentSchool
	,GradeLevel.VALUE_DESCRIPTION AS CurrentYearEnrollmentGrade
	,Enroll.ENTER_DATE AS CurrentYearEnrollmentEnterDate
	,Enroll.LEAVE_DATE AS CurrentYearEnrollmentLeaveDate

	,Student.STUDENT_GU
	,Test.TEST_GU
	,StudentTest.STUDENT_TEST_GU
	,Enroll.STUDENT_SCHOOL_YEAR_GU
FROM
	rev.EPC_STU_TEST AS StudentTest
	INNER JOIN
	rev.EPC_TEST AS Test
	ON
	StudentTest.TEST_GU = Test.TEST_GU

	INNER JOIN
	rev.EPC_STU AS Student
	ON
	StudentTest.STUDENT_GU = Student.STUDENT_GU

	INNER JOIN
	rev.REV_PERSON AS Person
	ON
	StudentTest.STUDENT_GU = Person.PERSON_GU

	LEFT JOIN
	APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
	ON
	StudentTest.STUDENT_GU = Enroll.STUDENT_GU

	LEFT JOIN
	rev.REV_ORGANIZATION_YEAR AS OrgYear
	ON
	Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU

	LEFT JOIN
	rev.REV_ORGANIZATION AS Org
	ON
	OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU

	LEFT JOIN
	APS.LookupTable('K12','Grade') AS GradeLevel
	ON
	Enroll.GRADE = GradeLevel.VALUE_CODE

	LEFT JOIN
	rev.EPC_TEST_PART AS PART
	--ON PART.TEST_GU = STUDENTTEST.TEST_GU
	ON PART.TEST_GU = TEST.TEST_GU

	LEFT JOIN
	rev.EPC_STU_TEST_PART AS STU_PART
	ON STU_PART.STU_TEST_PART_GU = PART.TEST_PART_GU
	AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
	

	LEFT JOIN
	rev.EPC_STU_TEST_PART_SCORE AS SCORE
	ON SCORE.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU

WHERE
	test.TEST_NAME = 'SBA ES 2011 Plus'

ORDER BY Student.SIS_NUMBER
