USE [Assessments]
GO

SELECT [District IRN]
      ,[District Name]
      ,[School IRN]
      ,[School Name]
      ,BS.[GRADE] AS Grade
      ,BS.STATE_STUDENT_NUMBER AS [Student STATE ID]
	  --,[Student STATE ID]
      --,[Last Name]
	  ,LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
       LTRIM(RTRIM([LAST NAME])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))
	   AS [Last Name]
	,LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(
       LTRIM(RTRIM([First NAME])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))
	   AS [First Name]	  
      ,[Middle Initial]
      ,BS.birthdate AS [Birth Date (MMDDYYYY)]
      ,BS.GENDER AS [Gender (M/F)]
      ,BS.RESOLVED_RACE AS [Ethinicity]
  FROM [dbo].[001_APS_NMAPA_16-17] NMAPA
  LEFT JOIN
 PRIMARYENROLLMENTSASOF  AS BS
  ON (LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(NMAPA.[FIRST NAME])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))
 = LTRIM(RTRIM(BS.FIRST_NAME))
  AND LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(NMAPA.[Last Name])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))
 = LTRIM(RTRIM(BS.LAST_NAME))
 OR (LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(NMAPA.[Student STATE ID])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))) = BS.STATE_STUDENT_NUMBER  OR (LTRIM(RTRIM(REPLACE(REPLACE(REPLACE(REPLACE(REPLACE(LTRIM(RTRIM(NMAPA.[Student STATE ID])), CHAR('160'), ''), CHAR(10), '7'), CHAR(11), '7'), CHAR(12), '7'), CHAR(13), '7')))) = BS.SIS_NUMBER)

  AND RIGHT(NMAPA.[School IRN],3) = BS.SCHOOL_CODE
WHERE 1 = 1
--AND [Student STATE ID] IS NULL
ORDER BY [Student STATE ID]
GO

