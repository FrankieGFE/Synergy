USE [SchoolNet]

SELECT
	ID_NBR
	,LST_NME
	,FRST_NME
	,SCH_NBR
	,GRDE AS GRADE
	,'2013-2014' AS SCHOOL_YEAR
	,TEST_NAME
	,TEST_SCORE
	,PERFORMANCE_LEVEL
	,SBA_MATH
	,SBA_READING
	,COURSE_TITLE
	--,[ALGEBRA I],[ALGEBRA I BIL],[LANGUAGE ART 7E],[LANGUAGE ARTS],[LANGUAGE ARTS 6],[LANGUAGE ARTS 7],[LANGUAGE ARTS 8],[LANGUAGE DEV],[LANGUAGE STIM],[MATH 6],[MATH 6 DUAL],[MATH 6/7 ACC],[MATH 7],[MATH 7 DUAL],[MATH 7/8 ACC],[MATH 8],[MATH 8 DUAL],[MATH I],[MATH STRAT 6-8],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM],[SS SP 6 LA],[SS SP LA 7],[SS SP LA 8]
	--,[LANGUAGE ARTS],[LANGUAGE ARTS 6],[LANGUAGE STIM],[MATH  4],[MATH 1],[MATH 2],[MATH 3],[MATH 4],[MATH 6],[MATH 6 DUAL],[MATH 6/7 ACC],[MATH 7],[MATH 7 DUAL],[MATH 7/8 ACC],[MATH 8],[MATH 8 DUAL],[MATH I],[MATH STRAT 6-8],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM]
	--,[ALGEBRA I],[ALGEBRA I BIL],[ALGEBRA I H BIL],[ALGEBRA I HON],[ALGEBRA II],[ALGEBRAIC MODEL],[AP ENGLNGCOMP11],[AP ENGLNGCOMP12],[AP SPAN V LIT],[AP SPAN V LNG],[AP STATISTICS],[ENG 10/ESL 2],[ENG 10/ESL 3],[ENG 11/ESL 1],[ENG 11/ESL 2],[ENG 11/ESL 3],[ENG 11/ESL 4],[ENG 12/ESL 3],[ENG 12/ESL 4],[ENG 9/ESL 1],[ENG 9/ESL 2],[ENG 9/ESL 3],[ENG 9/ESL 4],[ENGLISH 09],[ENGLISH 09 HON],[ENGLISH 10],[ENGLISH 10 HON],[ENGLISH 11],[ENGLISH 12],[ENGLISH 9],[ESL-E09],[FUNC MTH],[FUNC READING],[FUNCTIONAL RDNG],[GEOMETRY],[GEOMETRY BIL],[GEOMETRY HON],[HON ALG II/TRIG],[HON ENG 9],[LANGUAGE DEV],[LANGUAGE STIM],[LITERACY STRAT1],[LITERACY STRAT3],[LITERACY STRAT3],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM],[PRB SOLV],[PRE CALC HON],[PRE CALCULUS],[SPAN LNGARTS I],[SPAN LNGARTS II],[SPAN LNGARTSIII]

FROM
(
SELECT
	ROW_NUMBER () OVER (PARTITION BY ELL.[ID_NBR] ORDER BY END_ENR_DT DESC) AS RN
	,ELL.ID_NBR
	,STUD.LST_NME
	,STUD.FRST_NME
	,SCH.SCH_NBR
	,SCH.GRDE
	,ELL.TEST_NAME
	,ELL.TEST_SCORE
	,ELL.PERFORMANCE_LEVEL
	,SBA.MATH AS SBA_MATH
	,SBA.READING AS SBA_READING
	,SCH.END_ENR_DT
	,ELL.COURSE_TITLE
	,ELL.STATUS
	,COURSE.Mark
	,COURSE.Course
FROM
	[CHRIS_META Students Receiving Services rev] AS ELL
LEFT JOIN
	[011-synergydb.APS.Edu.ACTD].PR.DBTSIS.CE020 AS STUD
	ON ELL.ID_NBR = CAST(STUD.ID_NBR AS VARCHAR(50))

LEFT JOIN
	[011-synergydb.APS.Edu.ACTD].PR.DBTSIS.ST010 AS SCH
	ON ELL.ID_NBR = CAST(SCH.ID_NBR AS VARCHAR(50))
	AND SCH.SCH_YR = '2014'
	AND NONADA_SCH != 'X'
LEFT JOIN
	[CHRIS_META Students_WITH_SBA] AS SBA
	ON ELL.ID_NBR = SBA.ID_NBR
LEFT JOIN
	CHRIS_STUDENT_COURSE_HISTORY AS COURSE
	ON ELL.ID_NBR = COURSE.[Student ID]
	--AND COURSE.TERM = 'S2'
) AS T1
PIVOT
(MAX([MARK]) FOR COURSE IN ([ALGEBRA I],[ALGEBRA I BIL],[LANGUAGE ART 7E],[LANGUAGE ARTS],[LANGUAGE ARTS 6],[LANGUAGE ARTS 7],[LANGUAGE ARTS 8],[LANGUAGE DEV],[LANGUAGE STIM],[MATH  4],[MATH 1],[MATH 2],[MATH 3],[MATH 4],[MATH 6],[MATH 6 DUAL],[MATH 6/7 ACC],[MATH 7],[MATH 7 DUAL],[MATH 7/8 ACC],[MATH 8],[MATH 8 DUAL],[MATH I],[MATH STRAT 6-8],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM],[SS SP 6 LA],[SS SP LA 7],[SS SP LA 8])) AS PIV1
--(MAX([MARK]) FOR COURSE IN ([LANGUAGE ARTS],[LANGUAGE ARTS 6],[LANGUAGE STIM],[MATH  4],[MATH 1],[MATH 2],[MATH 3],[MATH 4],[MATH 6],[MATH 6 DUAL],[MATH 6/7 ACC],[MATH 7],[MATH 7 DUAL],[MATH 7/8 ACC],[MATH 8],[MATH 8 DUAL],[MATH I],[MATH STRAT 6-8],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM])) AS PIV1
--(MAX([MARK]) FOR COURSE IN([ALGEBRA I],[ALGEBRA I BIL],[ALGEBRA I H BIL],[ALGEBRA I HON],[ALGEBRA II],[ALGEBRAIC MODEL],[AP ENGLNGCOMP11],[AP ENGLNGCOMP12],[AP SPAN V LIT],[AP SPAN V LNG],[AP STATISTICS],[ENG 10/ESL 2],[ENG 10/ESL 3],[ENG 11/ESL 1],[ENG 11/ESL 2],[ENG 11/ESL 3],[ENG 11/ESL 4],[ENG 12/ESL 3],[ENG 12/ESL 4],[ENG 9/ESL 1],[ENG 9/ESL 2],[ENG 9/ESL 3],[ENG 9/ESL 4],[ENGLISH 09],[ENGLISH 09 HON],[ENGLISH 10],[ENGLISH 10 HON],[ENGLISH 11],[ENGLISH 12],[ENGLISH 9],[ESL-E09],[FUNC MTH],[FUNC READING],[FUNCTIONAL RDNG],[GEOMETRY],[GEOMETRY BIL],[GEOMETRY HON],[HON ALG II/TRIG],[HON ENG 9],[LANGUAGE DEV],[LANGUAGE STIM],[LITERACY STRAT1],[LITERACY STRAT3],[MATH STRATEGY 2],[MATH STRATEGY I],[MATH STRATG III],[MATH STRATGY I],[MATH STRATGY II],[MATH TM],[PRB SOLV],[PRE CALC HON],[PRE CALCULUS],[SPAN LNGARTS I],[SPAN LNGARTS II],[SPAN LNGARTSIII]))AS PIV3
WHERE RN = 1
--AND GRDE IN ('06','07','08')
AND GRDE IN ('K','01','02','03','04','05')
--AND GRDE NOT IN ('06','07','08','K','01','02','03','04','05')
--AND ID_NBR = '100014752'
ORDER BY ID_NBR