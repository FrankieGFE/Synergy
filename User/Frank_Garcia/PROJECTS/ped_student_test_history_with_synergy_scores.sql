

WITH SBA_MATH_SCORE AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBAMath'
)

,SBA_MATH_PL AS

(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBAMath'
)

, SBA_READING_SCORE AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBAREADING'
)

,SBA_READING_PL AS

(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBAREADING'
)

, SBA_SCIENCE_SCORE AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBASCIENCE'
)

,SBA_SCIENCE_PL AS

(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('SCALE')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'SBASCIENCE'
)

, PARCC_ELA9_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA09'
)

,PARCC_ELA9_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA09'
)

,PARCC_ELA10_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA10'
)

,PARCC_ELA10_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA10'
)

,PARCC_ELA11_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA11'
)

,PARCC_ELA11_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCELA11'
)

,PARCC_ALG01_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCALG01'
)

,PARCC_ALG01_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCALG01'
)

,PARCC_ALG02_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCALG02'
)

,PARCC_ALG02_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCALG02'
)

,PARCC_GEO01_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCGEO01'
)

,PARCC_GEO01_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'PARCCGEO01'
)

,NMAPAMath_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAMath'
)

,NMAPAMath_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAMath'
)

,NMAPAReading_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAReading'
)

,NMAPAReading_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAReading'
)

,NMAPAScience_S AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       --,STU_PART.PERFORMANCE_LEVEL AS PL
       ,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(TEST_SCORE) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAScience'
)

,NMAPAScience_PL AS
(
SELECT DISTINCT 
		FIRST_NAME
		,LAST_NAME
		,SIS_NUMBER
		,TEST_NAME
		--,PL
		,[2012 Fall]
		,[2012 Spring]
		,[2013 Fall]
		,[2013 Spring]
		,[2014 Fall]
		,[2014 Spring]
		,[2015 Fall]
		,[2015 Spring]
		,[2016 Fall]
		,[2016 Spring] 
		FROM
(
SELECT 
	   --ROW_NUMBER () OVER (PARTITION BY SIS_NUMBER ORDER BY TEST_NAME, ADMIN_DATE DESC) AS RN
	   PERSON.FIRST_NAME
       ,PERSON.LAST_NAME
       ,CAST (SIS_NUMBER AS INT) AS SIS_NUMBER
       ,CASE WHEN TEST.TEST_NAME = 'PARCC HS Algebra II' THEN 'PARCCALG02'
	         WHEN TEST.TEST_NAME = 'PARCC HS Algebra 1' THEN 'PARCCALG01'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 10' THEN 'PARCCELA10'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 11' THEN 'PARCCELA11'
			 WHEN TEST.TEST_NAME = 'PARCC HS ELA/L English 9' THEN 'PARCCELA09'
			 WHEN TEST.TEST_NAME = 'PARCC HS Geometry' THEN 'PARCCGEO01'
			 WHEN TEST.TEST_NAME = 'SBA HS Math 2011+' THEN 'SBAMath'
			 WHEN TEST.TEST_NAME = 'SBA HS Reading 2011+' THEN 'SBAReading'
			 WHEN TEST.TEST_NAME = 'SBA HS Science 2011+' THEN 'SBAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'MATH' THEN 'NMAPAMath'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'READING' THEN 'NMAPAReading'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SCIENCE' THEN 'NMAPAScience'
			 WHEN TEST.TEST_NAME = 'NMAPA' AND PART_DESCRIPTION = 'SOCIAL STUDIES' THEN 'NMAPASocialStudies'
			 ELSE TEST.TEST_NAME
	   END AS TEST_NAME
       ,STU_PART.PERFORMANCE_LEVEL AS PL
       --,SCORES.TEST_SCORE
	   ,CASE
			WHEN ADMIN_DATE = '2011-04-01 00:00:00' THEN '2011 Spring'
			WHEN ADMIN_DATE = '2011-10-01 00:00:00' THEN '2011 Fall'
			WHEN ADMIN_DATE = '2012-04-01 00:00:00' THEN '2012 Spring'
			WHEN ADMIN_DATE = '2012-10-01 00:00:00' THEN '2012 Fall'
			WHEN ADMIN_DATE = '2013-04-01 00:00:00' THEN '2013 Spring'
			WHEN ADMIN_DATE = '2013-10-01 00:00:00' THEN '2013 Fall'
			WHEN ADMIN_DATE = '2014-04-01 00:00:00' THEN '2014 Spring'
			WHEN ADMIN_DATE = '2014-10-01 00:00:00' THEN '2014 Fall'
			WHEN ADMIN_DATE = '2015-04-01 00:00:00' THEN '2015 Spring'
			WHEN ADMIN_DATE = '2015-10-01 00:00:00' THEN '2015 Fall'
			WHEN ADMIN_DATE = '2016-03-15 00:00:00' THEN '2016 Spring'
			WHEN ADMIN_DATE = '2016-04-01 00:00:00' THEN '2016 Spring'
		END AS TEST_DATE
FROM
       rev.EPC_STU_TEST AS StudentTest
       JOIN
       rev.EPC_TEST_PART AS PART
       ON StudentTest.TEST_GU = PART.TEST_GU
       JOIN
       rev.EPC_STU_TEST_PART AS STU_PART
       ON PART.TEST_PART_GU = STU_PART.TEST_PART_GU
       AND STU_PART.STUDENT_TEST_GU = StudentTest.STUDENT_TEST_GU
    INNER JOIN
    rev.EPC_STU_TEST_PART_SCORE AS SCORES
    ON
    SCORES.STU_TEST_PART_GU = STU_PART.STU_TEST_PART_GU
    LEFT JOIN
    rev.EPC_TEST_SCORE_TYPE AS SCORET
    ON
    SCORET.TEST_GU = StudentTest.TEST_GU
    AND SCORES.TEST_SCORE_TYPE_GU = SCORET.TEST_SCORE_TYPE_GU
    LEFT JOIN
    rev.EPC_TEST_DEF_SCORE AS SCORETDEF
    ON
    SCORETDEF.TEST_DEF_SCORE_GU = SCORET.TEST_DEF_SCORE_GU
       LEFT JOIN
       rev.EPC_TEST AS TEST
       ON TEST.TEST_GU = StudentTest.TEST_GU
       INNER JOIN
       rev.EPC_STU AS Student
       ON Student.STUDENT_GU = StudentTest.STUDENT_GU
       INNER JOIN
       rev.REV_PERSON AS Person
       ON Person.PERSON_GU = StudentTest.STUDENT_GU
       LEFT JOIN
       APS.PrimaryEnrollmentsAsOf(GETDATE()) AS Enroll
       ON
       StudentTest.STUDENT_GU = Enroll.STUDENT_GU
       LEFT JOIN
       rev.REV_ORGANIZATION_YEAR AS OrgYear
       ON
       Enroll.ORGANIZATION_YEAR_GU = OrgYear.ORGANIZATION_YEAR_GU
       LEFT JOIN
       rev.REV_ORGANIZATION AS Org
       ON
       OrgYear.ORGANIZATION_GU = Org.ORGANIZATION_GU
       LEFT JOIN
       APS.LookupTable('K12','Grade') AS GradeLevel
       ON
       Enroll.GRADE = GradeLevel.VALUE_CODE
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPYT AS TST_GRPYT
	   ON
	   TEST.TEST_GU = TST_GRPYT.TEST_GU
	   AND PART.TEST_PART_GU = TST_GRPYT.TEST_PART_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_TST_GRPY AS TST_GRPY
	   ON 
	   TST_GRPY.GRAD_REQ_DEF_TST_GRPY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_REQ AS DEF_GRPYT
	   ON
	   DEF_GRPYT.TEST_GU = TEST.TEST_GU
	   AND DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU = TST_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
	   LEFT JOIN
	   REV.EPC_GRAD_REQ_DEF_GRPYT_PL AS GRPYT_PL
	   ON GRPYT_PL.GRAD_REQ_DEF_TST_GRPTY_GU = DEF_GRPYT.GRAD_REQ_DEF_TST_GRPTY_GU
WHERE
1 = 1
AND SCORE_DESCRIPTION IN ('RAW')
) AS T1
PIVOT
(MAX(PL) FOR TEST_DATE IN ([2012 Fall],[2012 Spring],[2013 Fall],[2013 Spring],[2014 Fall],[2014 Spring],[2015 Fall],[2015 Spring],[2016 Fall],[2016 Spring])) AS PT1

WHERE 1 = 1
--AND RN = 1
AND TEST_NAME = 'NMAPAScience'
)


SELECT
	STU.SIS_NUMBER
	,STU.STATE_STUDENT_NUMBER
	,PED.SCHOOL_CODE
	,PED.SCHOOL_NAME
	,PED.GRADE
	,SMS.[2012 Fall] AS SBA_2012_FALL_MATH_SS
	,SMPL.[2012 Fall] AS SBA_2012_FALL_MATH_PL
	,SMS.[2012 Spring] AS SBA_2012_SPRING_MATH_SS
	,SMPL.[2012 Spring] AS SBA_2012_SPRING_MATH_PL
	,SMS.[2013 Fall] AS SBA_2013_FALL_MATH_SS
	,SMPL.[2013 FALL] AS SBA_2013_FALL_MATH_PL
	,SMS.[2013 Spring] AS SBA_2013_SPRING_MATH_SS
	,SMPL.[2012 Spring] AS SBA_2013_SPRING_MATH_PL
	,SMS.[2014 Fall] AS SBA_2014_FALL_MATH_SS
	,SMPL.[2014 Fall] AS SBA_2014_FALL_MATH_PL
	,SMS.[2014 Spring] AS SBA_2014_SPRING_MATH_SS
	,SMPL.[2014 Spring] AS SBA_2014_SPRING_MATH_PL
	,SMS.[2015 Fall] AS SBA_2015_FALL_MATH_SS
	,SMPL.[2015 Fall] AS SBA_2015_FALL_MATH_PL
	,SMS.[2015 Spring] AS SBA_2015_SPRING_MATH_SS
	,SMPL.[2015 Spring] AS SBA_2015_SPRING_MATH_PL
	,SMS.[2016 Fall] AS SBA_2016_FALL_MATH_SS
	,SMPL.[2016 Fall] AS SBA_2016_FALL_MATH_PL
	,SMS.[2016 Spring] AS SBA_2016_SPRING_MATH_SS
	,SMPL.[2016 Spring] AS SBA_2016_SPRING_MATH_PL
	,SRPL.[2012 Fall] AS SBA_2012_FALL_READING_PL
	,SRS.[2012 Spring] AS SBA_2012_SPRING_READING_SS
	,SRPL.[2012 Spring] AS SBA_2012_SPRING_READING_PL
	,SRS.[2013 Fall] AS SBA_2013_FALL_READING_SS
	,SRPL.[2013 FALL] AS SBA_2013_FALL_READING_PL
	,SRS.[2013 Spring] AS SBA_2013_SPRING_READING_SS
	,SRPL.[2012 Spring] AS SBA_2013_SPRING_READING_PL
	,SRS.[2014 Fall] AS SBA_2014_FALL_READING_SS
	,SRPL.[2014 Fall] AS SBA_2014_FALL_READING_PL
	,SRS.[2014 Spring] AS SBA_2014_SPRING_READING_SS
	,SRPL.[2014 Spring] AS SBA_2014_SPRING_READING_PL
	,SRS.[2015 Fall] AS SBA_2015_FALL_READING_SS
	,SRPL.[2015 Fall] AS SBA_2015_FALL_READING_PL
	,SRS.[2015 Spring] AS SBA_2015_SPRING_READING_SS
	,SRPL.[2015 Spring] AS SBA_2015_SPRING_READING_PL
	,SRS.[2016 Fall] AS SBA_2016_FALL_SS
	,SRPL.[2016 Fall] AS SBA_2016_FALL_PL
	,SRS.[2016 Spring] AS SBA_2016_SPRING_SS
	,SRPL.[2016 Spring] AS SBA_2016_SPRING_PL
	,SSS.[2012 Fall] AS SBA_2012_FALL_SCIENCE_SS
	,SSPL.[2012 Fall] AS SBA_2012_FALL_SCIENCE_PL
	,SSS.[2012 Spring] AS SBA_2012_SPRING_SCIENCE_SS
	,SSPL.[2012 Spring] AS SBA_2012_SPRING_SCIENCE_PL
	,SSS.[2013 Fall] AS SBA_2013_FALL_SCIENCE_SS
	,SSPL.[2013 FALL] AS SBA_2013_FALL_SCIENCE_PL
	,SSS.[2013 Spring] AS SBA_2013_SPRING_SCIENCE_SS
	,SSPL.[2012 Spring] AS SBA_2013_SPRING_SCIENCE_PL
	,SSS.[2014 Fall] AS SBA_2014_FALL_SCIENCE_SS
	,SSPL.[2014 Fall] AS SBA_2014_FALL_SCIENCE_PL
	,SSS.[2014 Spring] AS SBA_2014_SPRING_SCIENCE_SS
	,SSPL.[2014 Spring] AS SBA_2014_SPRING_SCIENCE_PL
	,SSS.[2015 Fall] AS SBA_2015_FALL_SCIENCE_SS
	,SSPL.[2015 Fall] AS SBA_2015_FALL_SCIENCE_PL
	,SSS.[2015 Spring] AS SBA_2015_SPRING_SCIENCE_SS
	,SSPL.[2015 Spring] AS SBA_2015_SPRING_SCIENCE_PL
	,SSS.[2016 Fall] AS SBA_2016_FALL_SCIENCE_SS
	,SSPL.[2016 Fall] AS SBA_2016_FALL_SCIENCE_PL
	,SSS.[2016 Spring] AS SBA_2016_SPRING_SCIENCE_SS
	,SSPL.[2016 Spring] AS SBA_2016_SPRING_SCIENCE_PL
	,PELA9S.[2015 Spring] AS PARCC_2015_SPRING_ELA_09_SS
	,PELA9PL.[2015 Spring] AS PARCC_2015_SPRING_ELA_09_PL
	,PELA9S.[2016 FALL] AS PARCC_2016_FALL_ELA_09_SS
	,PELA9PL.[2016 Fall] AS PARCC_2016_FALL_ELA_09_PL
	,PELA9S.[2016 Spring] AS PARCC_2016_SPRING_ELA_09_SS
	,PELA9PL.[2016 Spring] AS PARCC_2016_SPRING_ELA_09_PL
	,PELA10S.[2015 Spring] AS PARCC_2015_SPRING_ELA_10_SS
	,PELA10PL.[2015 Spring] AS PARCC_2015_SPRING_ELA_10_PL
	,PELA10S.[2016 FALL] AS PARCC_2016_FALL_ELA_10_SS
	,PELA10PL.[2016 Fall] AS PARCC_2016_FALL_ELA_10_PL
	,PELA10S.[2016 Spring] AS PARCC_2016_SPRING_ELA_10_SS
	,PELA10PL.[2016 Spring] AS PARCC_2016_SPRING_ELA_10_PL
	,PELA11S.[2015 Spring] AS PARCC_2015_SPRING_ELA_11_SS
	,PELA11PL.[2015 Spring] AS PARCC_2015_SPRING_ELA_11_PL
	,PELA11S.[2016 FALL] AS PARCC_2016_FALL_ELA_11_SS
	,PELA11PL.[2016 Fall] AS PARCC_2016_FALL_ELA_11_PL
	,PELA11S.[2016 Spring] AS PARCC_2016_SPRING_ELA_11_SS
	,PELA11PL.[2016 Spring] AS PARCC_2016_SPRING_ELA_11_PL
	,PALG01S.[2015 Spring] AS PARCC_2015_SPRING_ALG01_SS
	,PALG01PL.[2015 Spring] AS PARCC_2015_SPRING_ALG01_PL
	,PALG01S.[2016 FALL] AS PARCC_2016_FALL_ALG01_SS
	,PALG01PL.[2016 Fall] AS PARCC_2016_FALL_ALG01_PL
	,PALG01S.[2016 Spring] AS PARCC_2016_SPRING_ALG01_SS
	,PALG01PL.[2016 Spring] AS PARCC_2016_SPRING_ALG01_PL
	,PALG02S.[2015 Spring] AS PARCC_2015_SPRING_ALG02_SS
	,PALG02PL.[2015 Spring] AS PARCC_2015_SPRING_ALG02_PL
	,PALG02S.[2016 FALL] AS PARCC_2016_FALL_ALG02_SS
	,PALG02PL.[2016 Fall] AS PARCC_2016_FALL_ALG02_PL
	,PALG02S.[2016 Spring] AS PARCC_2016_SPRING_ALG02_SS
	,PALG02PL.[2016 Spring] AS PARCC_2016_SPRING_ALG02_PL
	,PGEO01S.[2015 Spring] AS PARCC_2015_SPRING_GEO01_SS
	,PGEO01PL.[2015 Spring] AS PARCC_2015_SPRING_GEO01_PL
	,PGEO01S.[2016 FALL] AS PARCC_2016_FALL_GEO01_SS
	,PGEO01PL.[2016 Fall] AS PARCC_2016_FALL_GEO01_PL
	,PGEO01S.[2016 Spring] AS PARCC_2016_SPRING_GEO01_SS
	,PGEO01PL.[2016 Spring] AS PARCC_2016_SPRING_GEO01_PL
	,NMAPAMathS.[2014 Spring] AS PARCC_2014_SPRING_NMAPAMath_SS
	,NMAPAMathPL.[2014 Spring] AS PARCC_2014_SPRING_NMAPAMath_PL
	,NMAPAMathS.[2015 Spring] AS PARCC_2015_SPRING_NMAPAMath_SS
	,NMAPAMathPL.[2015 Spring] AS PARCC_2015_SPRING_NMAPAMath_PL
	,NMAPAMathS.[2016 FALL] AS PARCC_2016_FALL_NMAPAMath_SS
	,NMAPAMathPL.[2016 Fall] AS PARCC_2016_FALL_NMAPAMath_PL
	,NMAPAMathS.[2016 Spring] AS PARCC_2016_SPRING_NMAPAMath_SS
	,NMAPAMathPL.[2016 Spring] AS PARCC_2016_SPRING_NMAPAMath_PL
	,NMAPAReadingS.[2014 Spring] AS PARCC_2014_SPRING_NMAPAReading_SS
	,NMAPAReadingPL.[2014 Spring] AS PARCC_2014_SPRING_NMAPAReading_PL
	,NMAPAReadingS.[2015 Spring] AS PARCC_2015_SPRING_NMAPAReading_SS
	,NMAPAReadingPL.[2015 Spring] AS PARCC_2015_SPRING_NMAPAReading_PL
	,NMAPAReadingS.[2016 FALL] AS PARCC_2016_FALL_NMAPAReading_SS
	,NMAPAReadingPL.[2016 Fall] AS PARCC_2016_FALL_NMAPAReading_PL
	,NMAPAReadingS.[2016 Spring] AS PARCC_2016_SPRING_NMAPAReading_SS
	,NMAPAReadingPL.[2016 Spring] AS PARCC_2016_SPRING_NMAPAReading_PL
	,NMAPAScienceS.[2014 Spring] AS PARCC_2014_SPRING_NMAPAScience_SS
	,NMAPASciencePL.[2014 Spring] AS PARCC_2014_SPRING_NMAPAScience_PL
	,NMAPAScienceS.[2015 Spring] AS PARCC_2015_SPRING_NMAPAScience_SS
	,NMAPASciencePL.[2015 Spring] AS PARCC_2015_SPRING_NMAPAScience_PL
	,NMAPAScienceS.[2016 FALL] AS PARCC_2016_FALL_NMAPAScience_SS
	,NMAPASciencePL.[2016 Fall] AS PARCC_2016_FALL_NMAPAScience_PL
	,NMAPAScienceS.[2016 Spring] AS PARCC_2016_SPRING_NMAPAScience_SS
	,NMAPASciencePL.[2016 Spring] AS PARCC_2016_SPRING_NMAPAScience_PL

	FROM
	APS.PrimaryEnrollmentDetailsAsOf (GETDATE()) AS PED

	JOIN
	REV.EPC_STU AS STU
	ON STU.STUDENT_GU = PED.STUDENT_GU

	JOIN 
	(
	SELECT DISTINCT STUDENTID
			FROM APS.PED_Student_Test_History_File
	) AS PEDF
	ON PEDF.StudentID = STU.STATE_STUDENT_NUMBER

	LEFT JOIN
	SBA_MATH_SCORE AS SMS
	ON SMS.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN 
	SBA_MATH_PL AS SMPL
	ON SMPL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN SBA_READING_SCORE AS SRS
	ON SRS.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN SBA_READING_PL AS SRPL
	ON SRPL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN SBA_SCIENCE_SCORE AS SSS
	ON SSS.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN SBA_SCIENCE_PL AS SSPL
	ON SSPL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA9_S AS PELA9S
	ON PELA9S.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA9_PL AS PELA9PL
	ON PELA9PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA10_S AS PELA10S
	ON PELA10S.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA10_PL AS PELA10PL
	ON PELA10PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA11_S AS PELA11S
	ON PELA11S.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ELA11_PL AS PELA11PL
	ON PELA11PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ALG01_S AS PALG01S
	ON PALG01S.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ALG01_PL AS PALG01PL
	ON PALG01PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_ALG02_S AS PALG02S
	ON PALG02S.SIS_NUMBER =  STU.SIS_NUMBER

	LEFT JOIN PARCC_ALG02_PL AS PALG02PL
	ON PALG02PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_GEO01_S AS PGEO01S
	ON PGEO01S.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN PARCC_GEO01_PL AS PGEO01PL
	ON PGEO01PL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAMath_S AS NMAPAMATHS
	ON NMAPAMATHS.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAMath_PL AS NMAPAMATHPL
	ON NMAPAMathPL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAReading_S AS NMAPAREADINGS
	ON NMAPAReadingS.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAReading_PL AS NMAPAREADINGPL
	ON NMAPAREADINGPL.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAScience_S AS NMAPASCIENCES
	ON NMAPASCIENCES.SIS_NUMBER = STU.SIS_NUMBER

	LEFT JOIN NMAPAScience_PL AS NMAPASCIENCEPL
	ON NMAPASCIENCEPL.SIS_NUMBER = STU.SIS_NUMBER


ORDER BY SBA_2015_SPRING_MATH_PL


