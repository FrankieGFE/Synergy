USE [AIMS]
GO

SELECT
	SIS_NUMBER
	,LAST_NAME
	,FIRST_NAME
	,GRADE
	,SPED_STATUS
	,ELL_STATUS
	,ORGANIZATION_NAME
	,COURSE_ID
	,SECTION_ID
	,COURSE_TITLE
	,TERM_CODE
	,Intervention
	,GROUPS
FROM
(
SELECT 
	  DISTINCT
	  SORTED.[SIS_NUMBER]
      ,[LAST_NAME]
      ,[FIRST_NAME]
      ,[GRADE]
      ,[SPED_STATUS]
      ,[ELL_STATUS]
      ,[ORGANIZATION_NAME]
      ,[COURSE_ID]
      ,[SECTION_ID]
      ,[COURSE_TITLE]
      ,[TERM_CODE]
      ,[Intervention]
	  ,RNS.GROUPS
  FROM [dbo].[TRASH_Intervention sorted 112816] AS SORTED

  LEFT JOIN
  (
		SELECT
			ORGANIZATION_NAME + SIS_NUMBER AS GROUPS
			,SIS_NUMBER
		FROM
		(
		SELECT 
			 DISTINCT ROW_NUMBER () OVER (PARTITION BY sis_number, [ORGANIZATION_NAME] ORDER BY sis_number, organization_name) AS RN
			  ,[SIS_NUMBER]
   
			  ,[ORGANIZATION_NAME]

		  FROM [dbo].[TRASH_Intervention sorted 112816]
		) as t1
		  WHERE RN = 3
  ) AS RNS
  ON RNS.SIS_NUMBER = SORTED.SIS_NUMBER
  --ORDER BY RNS.GROUPS
) T2
--where SIS_NUMBER = '970009896'
ORDER BY GROUPS, LAST_NAME, FIRST_NAME
GO


