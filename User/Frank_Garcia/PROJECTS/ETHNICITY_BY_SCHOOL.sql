



/*
SELECT 
	SCH.SCHOOL_CODE
	,ORG.ORGANIZATION_NAME
	,COUNT (STU.SIS_NUMBER) AS [TOTAL STUDENTS]

FROM
	APS.EnrollmentsAsOf ('2016-10-01') ENR
	JOIN
	REV.REV_ORGANIZATION_YEAR OY
	ON OY.ORGANIZATION_YEAR_GU = ENR.ORGANIZATION_YEAR_GU
	JOIN 
	REV.REV_ORGANIZATION ORG
	ON OY.ORGANIZATION_GU = ORG.ORGANIZATION_GU
	JOIN
	REV.EPC_SCH SCH
	ON SCH.ORGANIZATION_GU = ORG.ORGANIZATION_GU
	JOIN 
	REV.EPC_STU STU
	ON STU.STUDENT_GU = ENR.STUDENT_GU
	JOIN 
	APS.BasicStudentWithMoreInfo BS
	ON BS.STUDENT_GU = ENR.STUDENT_GU

WHERE SCHOOL_CODE > '500'
      AND SCHOOL_CODE NOT IN ()
GROUP BY SCHOOL_CODE, ORGANIZATION_NAME
ORDER BY SCHOOL_CODE
*/


SELECT
	*
FROM
(
SELECT 
	SCH.SCHOOL_CODE
	,ORG.ORGANIZATION_NAME
	,STU.SIS_NUMBER
	,BS.RESOLVED_RACE
	--,*

FROM
	APS.EnrollmentsAsOf ('2016-10-01') ENR
	JOIN
	REV.REV_ORGANIZATION_YEAR OY
	ON OY.ORGANIZATION_YEAR_GU = ENR.ORGANIZATION_YEAR_GU
	JOIN 
	REV.REV_ORGANIZATION ORG
	ON OY.ORGANIZATION_GU = ORG.ORGANIZATION_GU
	JOIN
	REV.EPC_SCH SCH
	ON SCH.ORGANIZATION_GU = ORG.ORGANIZATION_GU
	JOIN 
	REV.EPC_STU STU
	ON STU.STUDENT_GU = ENR.STUDENT_GU
	JOIN 
	APS.BasicStudentWithMoreInfo BS
	ON BS.STUDENT_GU = ENR.STUDENT_GU

WHERE SCHOOL_CODE > '500'
--GROUP BY SCHOOL_CODE, ORGANIZATION_NAME, RESOLVED_RACE
) T1
PIVOT
	(COUNT([SIS_NUMBER]) FOR RESOLVED_RACE IN ([WHITE],[HISPANIC],[NATIVE AMERICAN],[AFRICAN-AMERICAN],[ASIAN],[PACIFIC ISLANDER],[TWO OR MORE])) AS UP1


ORDER BY SCHOOL_CODE
