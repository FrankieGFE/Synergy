

SELECT 
	SIS_NUMBER
	,PERS.LAST_NAME AS STU_LAST
	,PERS.FIRST_NAME AS STU_FIRST
	,PARENT.ADULT_ID
	,PPARENT.LAST_NAME AS PARENT_LAST
	,PPARENT.FIRST_NAME AS PARENT_FIRST
	,NON.[USER_ID]
	,NON.[PASSWORD]
	,NON.[DISABLED]
	,NON.ACTIVATION_DATETIME
	,CONTACT_ALLOWED
	,HAS_CUSTODY
	,LIVES_WITH
FROM
rev.EPC_STU_PARENT AS PARENTS
INNER JOIN
APS.PrimaryEnrollmentsAsOf (GETDATE()) AS ENR
ON
PARENTS.STUDENT_GU = ENR.STUDENT_GU
INNER JOIN
rev.EPC_STU AS STU
ON
STU.STUDENT_GU = ENR.STUDENT_GU
INNER JOIN
rev.REV_PERSON AS PERS
ON
STU.STUDENT_GU = PERS.PERSON_GU
INNER JOIN
rev.EPC_PARENT AS PARENT
ON
PARENTS.PARENT_GU = PARENT.PARENT_GU
INNER JOIN
rev.REV_PERSON AS PPARENT
ON
PPARENT.PERSON_GU = PARENT.PARENT_GU
--INNER JOIN
--rev.REV_ORGANIZATION_YEAR AS ORGYR
--ON
--ORGYR.ORGANIZATION_YEAR_GU = ENR.ORGANIZATION_YEAR_GU
--INNER JOIN
--rev.REV_ORGANIZATION AS SCH
--ON
--SCH.ORGANIZATION_GU = ORGYR.ORGANIZATION_GU

INNER JOIN
REV.REV_USER_NON_SYS AS NON
ON 
NON.PERSON_GU = PARENT.PARENT_GU

WHERE
	NON.[USER_ID] IS NOT NULL
	AND NON.[PASSWORD] IS NOT NULL
	AND NON.[DISABLED] = 'N'
	AND NON.ACTIVATION_DATETIME IS NOT NULL
	--AND CONTACT_ALLOWED = 'Y'
	--AND LIVES_WITH = 'Y'
ORDER BY SIS_NUMBER