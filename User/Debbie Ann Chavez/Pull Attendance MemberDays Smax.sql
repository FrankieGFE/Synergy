/*
SELECT AT12.*, MEM12.*, PRIM12.GRDE FROM 
dbo.ATTENDANCE_2012 AS AT12
RIGHT JOIN 
dbo.MEMBERDAYS_2012 AS MEM12
ON
AT12.IDNBR = MEM12.IDNBR
AND AT12.SCHNBR = MEM12.SCHNBR
LEFT JOIN 
APS.MostRecentPrimaryEnrollBySchYr(2012) AS PRIM12
ON
PRIM12.ID_NBR = MEM12.IDNBR

ORDER BY MEM12.SCHNBR, MEM12.IDNBR


SELECT AT13.*, MEM13.*, PRIM13.GRDE FROM 
dbo.ATTENDANCE_2013 AS AT13
RIGHT JOIN 
dbo.MEMBERDAYS_2013 AS MEM13
ON
AT13.IDNBR = MEM13.IDNBR
AND AT13.SCHNBR = MEM13.SCHNBR
LEFT JOIN 
APS.MostRecentPrimaryEnrollBySchYr(2013) AS PRIM13
ON
PRIM13.ID_NBR = MEM13.IDNBR

ORDER BY MEM13.SCHNBR, MEM13.IDNBR
*/

--2012-2014

SELECT 
CASE WHEN TOTAL_ABSENCES IS NULL THEN '0.00' ELSE TOTAL_ABSENCES END AS TOTAL_ABSENCES_DAYS
,IDNBR
,SCHYR
,SCHNBR
,MEMBERDAYS
,GRDE AS GRADE
 
FROM (

SELECT 

AT14.TOTAL_ABSENCES 
, MEM14.IDNBR
, MEM14.SCHYR
, MEM14.SCHNBR
, MEM14.MEMBERDAYS
, PRIM14.GRDE

FROM 
dbo.ATTENDANCE_REDO_2014 AS AT14
RIGHT JOIN 
dbo.MEMBERDAYS_2014 AS MEM14
ON
AT14.ID_NBR = MEM14.IDNBR
AND AT14.SCH_NBR = MEM14.SCHNBR
LEFT JOIN 
APS.MostRecentPrimaryEnrollBySchYr(2014) AS PRIM14
ON
PRIM14.ID_NBR = MEM14.IDNBR

WHERE
	(MEM14.SCHNBR BETWEEN '399' AND '600' 
	 OR MEM14.SCHNBR = '840')
) AS T1


ORDER BY SCHNBR, IDNBR