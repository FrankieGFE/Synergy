
SELECT 
		STATE_STUDENT_NUMBER
		, ENTRY_DATE
		, EXIT_DATE
,CASE 
WHEN EXIT_DATE IS NULL AND (ENTRY_DATE >= '2014-07-01' AND ENTRY_DATE <= '2015-06-30') THEN  'Y'
WHEN EXIT_DATE IS NULL AND ENTRY_DATE < '2015-06-30' THEN 'Y'
WHEN EXIT_DATE > '2014-07-01' THEN 'Y'
ELSE NULL END AS [2014-2015]

,CASE 
WHEN EXIT_DATE IS NULL AND (ENTRY_DATE >= '2013-07-01' AND ENTRY_DATE <= '2014-06-30')THEN  'Y' 
WHEN EXIT_DATE IS NULL AND ENTRY_DATE < '2014-06-30' THEN 'Y'
WHEN EXIT_DATE > '2013-07-01' THEN 'Y'
ELSE NULL END AS [2013-2014]

,CASE 
WHEN EXIT_DATE IS NULL AND (ENTRY_DATE >= '2012-07-01' AND ENTRY_DATE <= '2013-06-30') THEN  'Y' 
WHEN EXIT_DATE IS NULL AND ENTRY_DATE < '2013-06-30' THEN 'Y'
WHEN EXIT_DATE > '2012-07-01' THEN 'Y'
ELSE NULL END AS [2012-2013]

,CASE 
WHEN EXIT_DATE IS NULL AND (ENTRY_DATE >= '2011-07-01' AND ENTRY_DATE <= '2012-06-30') THEN  'Y'
WHEN EXIT_DATE IS NULL AND ENTRY_DATE < '2012-06-30' THEN 'Y'
WHEN EXIT_DATE > '2011-07-01' THEN 'Y'
ELSE NULL END AS [2011-2012]

	
	 FROM 
	
	(
	SELECT 
	STATE_STUDENT_NUMBER, MAX(CAST(history.ENTRY_DATE AS DATE)) AS ENTRY_DATE
	, MAX(CAST(EXIT_DATE AS DATE)) AS EXIT_DATE
	FROM
	rev.EPC_STU_PGM_ELL_HIS AS History
	INNER JOIN 
	rev.EPC_STU AS STU
	ON
	History.STUDENT_GU = STU.STUDENT_GU
	GROUP BY STATE_STUDENT_NUMBER
	) AS ELL

