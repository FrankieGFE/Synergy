
SELECT 
	ORGANIZATION_NAME
	,SIS_NUMBER
	, STU_NAME
	, GRADE
	,PRIMARY_DISABILITY_CODE
	,TEST_NAME
	,TEST_SCORE
	,COUNT_LCECLASS
	,PARENT_REFUSED
	,CASE WHEN COUNT_LCECLASS = 0 THEN 'N' ELSE 'Y' END AS RECEIVING_SERVICES
FROM (
SELECT 
	ORGANIZATION_NAME
	,SIS_NUMBER
	, STU_NAME
	, GRADE
	,PRIMARY_DISABILITY_CODE
	,TEST_NAME
	,TEST_SCORE
	,COUNT (STAFF_NAME) AS COUNT_LCECLASS
	,COUNT (WAIVER_TYPE) AS PARENT_REFUSED

 FROM
APS.LCEStudentsAndProvidersAsOf (GETDATE())

--WHERE
--SIS_NUMBER IN (970072120, 980000648)

GROUP BY 	ORGANIZATION_NAME
	,SIS_NUMBER
	, STU_NAME
	, GRADE
	,PRIMARY_DISABILITY_CODE
	,TEST_NAME
	,TEST_SCORE
)
AS T1

ORDER BY SIS_NUMBER
