EXECUTE AS LOGIN='QueryFileUser'
GO


--SELECT 
--	ONLYLCE.SIS_NUMBER, ONLYLCE.STATE_STUDENT_NUMBER, 
--	CASE WHEN [STATUS] = 'ELL' THEN 1
--		WHEN [STATUS] = 'EXIT YEAR 1' THEN 2
--		WHEN [STATUS] = 'EXIT YEAR 2' THEN 3
--		WHEN [STATUS] = 'EXIT YEAR 3+' THEN 4
--		WHEN [STATUS] = 'Never ELL' THEN 0
--	ELSE '' END AS ENGLISH_PROFICIENCY

--	,ONLYLCE.*

-- FROM 

--(
--SELECT T4.*
--	,CASE WHEN LCE.SIS_NUMBER IS NULL AND T4.[STATUS] = 'ELL' THEN 'NOT ON REPORT' ELSE '' END AS REPORT
--	,HISTORY.EXIT_REASON


-- FROM 

--(
--SELECT 
--	SIS_NUMBER, STATE_STUDENT_NUMBER, ADMIN_DATE, TEST_NAME, PERFORMANCE_LEVEL, TOTAL,EVER_ELL
--	,CASE WHEN TOTAL >= 3 THEN 'EXIT YEAR 3+' 
--			WHEN TOTAL = 2 THEN 'EXIT YEAR 2'
--			WHEN TOTAL = 1 AND EVER_ELL = 'N' THEN 'Never ELL'
--			WHEN TOTAL = 1 THEN 'EXIT YEAR 1'
--		ELSE 'ELL' END AS [STATUS] 

--FROM (
--SELECT 
--	SIS_NUMBER, ADMIN_DATE, TEST_NAME, PERFORMANCE_LEVEL,EVER_ELL,STATE_STUDENT_NUMBER
--	,T16 + T15 + T14 + T13 + T12 + T11 + T10 + T09 + T08 + T07 + T06 + T05 + T04 + T03 + T02 AS TOTAL

--FROM(

--SELECT 
--	SIS_NUMBER, ADMIN_DATE, TEST_NAME, PERFORMANCE_LEVEL
--	--,EVER_ELL
--	,STATE_STUDENT_NUMBER
--	,LEFT(CAST(ADMIN_DATE AS DATE),4) AS LEFTDATE
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4) > 2017 THEN 0 ELSE [2017] END AS T17
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4) > 2016 THEN 0 ELSE [2016] END AS T16
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4) > 2015 THEN 0 ELSE [2015]  END AS T15
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2014 THEN 0 ELSE [2014]  END AS T14
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2013 THEN 0 ELSE [2013]  END AS T13
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2012 THEN 0 ELSE [2012]  END AS T12
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2011 THEN 0 ELSE [2011]  END AS T11
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2010 THEN 0 ELSE [2010]  END AS T10
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2009 THEN 0 ELSE [2009] END AS T09
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2008 THEN 0 ELSE [2008]  END AS T08
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2007 THEN 0 ELSE [2007]  END AS T07
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2006 THEN 0 ELSE [2006]  END AS T06
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2005 THEN 0 ELSE [2005] END AS T05
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2004 THEN 0 ELSE [2004]  END AS T04
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2003 THEN 0 ELSE [2003]  END AS T03
--	,CASE WHEN LEFT(CAST(ADMIN_DATE AS DATE),4)> 2002 THEN 0 ELSE [2002]  END AS T02

-- FROM 

--(

SELECT 
	STU.SIS_NUMBER, TEST.ADMIN_DATE, TEST.TEST_NAME, TEST.PERFORMANCE_LEVEL, TEST.IS_ELL, STU.STATE_STUDENT_NUMBER
	
		,CASE WHEN [2017].STUDENT_GU IS NOT NULL AND TEST.IS_ELL = 0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20160701' THEN 'EXIT' ELSE'0'END AS [2017_EXIT]
		,CASE WHEN [2017].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2016' AND '07-01-2017' THEN 'ELL' ELSE'0'END AS [2017_ENTER]
		,CASE WHEN [2017].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2017_ENROLL]
	
		,CASE WHEN [2016].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20150701' THEN 'EXIT' ELSE'0'END AS [2016_EXIT]
		,CASE WHEN [2016].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2015' AND '07-01-2016' THEN 'ELL' ELSE'0'END AS [2016_ENTER]
		,CASE WHEN [2016].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2016_ENROLL]
		
		,CASE WHEN [2015].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20140701' THEN 'EXIT' ELSE'0'END AS [2015_EXIT]
		,CASE WHEN [2015].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2014' AND '07-01-2015' THEN 'ELL' ELSE'0'END AS [2015_ENTER]
		,CASE WHEN [2015].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2015_ENROLL]
		
		,CASE WHEN [2014].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20130701' THEN 'EXIT' ELSE'0'END AS [2014_EXIT]
		,CASE WHEN [2014].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2013' AND '07-01-2014' THEN 'ELL' ELSE'0'END AS [2014_ENTER]
		,CASE WHEN [2014].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2014_ENROLL]
		
		,CASE WHEN [2013].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20120701' THEN 'EXIT' ELSE'0'END AS [2013_EXIT]
		,CASE WHEN [2013].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2012' AND '07-01-2013' THEN 'ELL' ELSE'0'END AS [2013_ENTER]
		,CASE WHEN [2013].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2013_ENROLL]
		
		,CASE WHEN [2012].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20110701' THEN 'EXIT' ELSE'0'END AS [2012_EXIT]
		,CASE WHEN [2012].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2011' AND '07-01-2012' THEN 'ELL' ELSE'0'END AS [2012_ENTER]
		,CASE WHEN [2012].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2012_ENROLL]
		
		,CASE WHEN [2011].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20100701' THEN 'EXIT' ELSE'0'END AS [2011_EXIT]
		,CASE WHEN [2011].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2010' AND '07-01-2011' THEN 'ELL' ELSE'0'END AS [2011_ENTER]
		,CASE WHEN [2011].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2011_ENROLL]
		
		,CASE WHEN [2010].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20090701' THEN 'EXIT' ELSE'0'END AS [2010_EXIT]
		,CASE WHEN [2010].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2009' AND '07-01-2010' THEN 'ELL' ELSE'0'END AS [2010_ENTER]
		,CASE WHEN [2010].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2010_ENROLL]
					
		,CASE WHEN [2009].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20080701' THEN 'EXIT' ELSE'0'END AS [2009_EXIT]
		,CASE WHEN [2009].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2008' AND '07-01-2009' THEN 'ELL' ELSE'0'END AS [2009_ENTER]
		,CASE WHEN [2009].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2009_ENROLL]
					
		,CASE WHEN [2008].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20070701' THEN 'EXIT' ELSE'0'END AS [2008_EXIT]
		,CASE WHEN [2008].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2007' AND '07-01-2008' THEN 'ELL' ELSE'0'END AS [2008_ENTER]
		,CASE WHEN [2008].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2008_ENROLL]
				 
		,CASE WHEN [2007].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20060701' THEN 'EXIT' ELSE'0'END AS [2007_EXIT]
		,CASE WHEN [2007].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2006' AND '07-01-2007' THEN 'ELL' ELSE'0'END AS [2007_ENTER]
		,CASE WHEN [2007].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2007_ENROLL]
					
		,CASE WHEN [2006].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20050701' THEN 'EXIT' ELSE'0'END AS [2006_EXIT]
		,CASE WHEN [2006].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2005' AND '07-01-2006' THEN 'ELL' ELSE'0'END AS [2006_ENTER]
		,CASE WHEN [2006].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2006_ENROLL]
				
		,CASE WHEN [2005].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20040701' THEN 'EXIT' ELSE'0'END AS [2005_EXIT]
		,CASE WHEN [2005].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2004' AND '07-01-2005' THEN 'ELL' ELSE'0'END AS [2005_ENTER]
		,CASE WHEN [2005].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2005_ENROLL]
		
		,CASE WHEN [2004].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20030701' THEN 'EXIT' ELSE'0'END AS [2004_EXIT]
		,CASE WHEN [2004].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2003' AND '07-01-2004' THEN 'ELL' ELSE'0'END AS [2004_ENTER]
		,CASE WHEN [2004].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2004_ENROLL]
				
		,CASE WHEN [2003].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20020701' THEN 'EXIT' ELSE'0'END AS [2003_EXIT]
		,CASE WHEN [2003].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2002' AND '07-01-2003' THEN 'ELL' ELSE'0'END AS [2003_ENTER]
		,CASE WHEN [2003].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2003_ENROLL]
					
		,CASE WHEN [2002].STUDENT_GU IS NOT NULL AND TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20010701' THEN 'EXIT' ELSE'0'END AS [2002_EXIT]
		,CASE WHEN [2002].STUDENT_GU IS NOT NULL AND FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2001' AND '07-01-2002' THEN 'ELL' ELSE'0'END AS [2002_ENTER]
		,CASE WHEN [2002].STUDENT_GU IS NOT NULL THEN '1' ELSE '0' END AS [2002_ENROLL]

		---- NO ENROLLMENTS PRIOR TO 2002 ----

		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '20000701' THEN 'EXIT' ELSE'0'END AS [2001_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-2000' AND '07-01-2001' THEN 'ELL' ELSE'0'END AS [2001_ENTER]

		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '19990701' THEN 'EXIT' ELSE'0'END AS [2000_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-1999' AND '07-01-2000' THEN 'ELL' ELSE'0'END AS [2000_ENTER]

		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '19980701' THEN 'EXIT' ELSE'0'END AS [1999_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-1998' AND '07-01-1999' THEN 'ELL' ELSE'0'END AS [1999_ENTER]
		
		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '19970701' THEN 'EXIT' ELSE'0'END AS [1998_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-1997' AND '07-01-1998' THEN 'ELL' ELSE'0'END AS [1998_ENTER]

		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '19960701' THEN 'EXIT' ELSE'0'END AS [1997_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-1996' AND '07-01-1997' THEN 'ELL' ELSE'0'END AS [1997_ENTER]

		,CASE WHEN TEST.IS_ELL =0 AND TEST.TEST_NAME NOT IN ('PRE-LAS', 'WAPT', 'SCREENER', 'SCRE') AND TEST.ADMIN_DATE < '19950701' THEN 'EXIT' ELSE'0'END AS [1996_EXIT]
		,CASE WHEN FIRSTTEST.IS_ELL =1 AND FIRSTTEST.ADMIN_DATE BETWEEN '07-01-1995' AND '07-01-1996' THEN 'ELL' ELSE'0'END AS [1996_ENTER]

 FROM 
rev.EPC_STU AS STU

INNER JOIN
APS.LCELatestEvaluationAsOf('20170814') AS TEST
ON
TEST.STUDENT_GU = STU.STUDENT_GU

INNER JOIN
APS.LCEFirstEvaluationAsOf('20170814') AS FIRSTTEST
ON
FIRSTTEST.STUDENT_GU = STU.STUDENT_GU

/*
2002	3D95815E-93DB-4E7A-9741-4252AB7D1DAA
2003	A1A45208-69FC-4E58-99B3-7501E9108D70
2004	F4F41066-7955-45DF-AD43-24A1462BFDAD
2005	BE3706A7-1239-4DAE-A038-F9A949DAA041
2006	CC1DCB76-576C-4414-B4BA-323A26EC8EBE
2007	48ADBFD4-1987-4E7C-9C22-6FD91E8FE424
2008	94A5BA26-69AD-4ADB-80E0-7FEDB7E686C9
2009	E5D120A6-6A1C-4C42-B1F0-4ADB36DE27EF
2010	87F1A309-F058-43E4-B55B-EF9AE4602639
2011	3732B795-5856-430E-996D-B75E6475EC32
2012	9864A8F3-6130-4F95-86D6-860A517D38D1
2013	1E61EA89-3410-49F8-909B-1B749957EDDA
2014	26F066A3-ABFC-4EDB-B397-43412EDABC8B
2015	BCFE2270-A461-4260-BA2B-0087CB8EC26A
2016	F7D112F7-354D-4630-A4BC-65F586BA42EC
2017    A3F9F1FB-4706-49AA-B3A3-21F153966191
*/


LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('A3F9F1FB-4706-49AA-B3A3-21F153966191') AS [2017]
ON
STU.STUDENT_GU = [2017].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('F7D112F7-354D-4630-A4BC-65F586BA42EC') AS [2016]
ON
STU.STUDENT_GU = [2016].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('BCFE2270-A461-4260-BA2B-0087CB8EC26A') AS [2015]
ON
STU.STUDENT_GU = [2015].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('26F066A3-ABFC-4EDB-B397-43412EDABC8B') AS [2014]
ON
STU.STUDENT_GU = [2014].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('1E61EA89-3410-49F8-909B-1B749957EDDA') AS [2013]
ON
STU.STUDENT_GU = [2013].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('9864A8F3-6130-4F95-86D6-860A517D38D1') AS [2012]
ON
STU.STUDENT_GU = [2012].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('3732B795-5856-430E-996D-B75E6475EC32') AS [2011]
ON
STU.STUDENT_GU = [2011].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('87F1A309-F058-43E4-B55B-EF9AE4602639') AS [2010]
ON
STU.STUDENT_GU = [2010].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('E5D120A6-6A1C-4C42-B1F0-4ADB36DE27EF') AS [2009]
ON
STU.STUDENT_GU = [2009].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('94A5BA26-69AD-4ADB-80E0-7FEDB7E686C9') AS [2008]
ON
STU.STUDENT_GU = [2008].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('48ADBFD4-1987-4E7C-9C22-6FD91E8FE424') AS [2007]
ON
STU.STUDENT_GU = [2007].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('CC1DCB76-576C-4414-B4BA-323A26EC8EBE') AS [2006]
ON
STU.STUDENT_GU = [2006].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('BE3706A7-1239-4DAE-A038-F9A949DAA041') AS [2005]
ON
STU.STUDENT_GU = [2005].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('F4F41066-7955-45DF-AD43-24A1462BFDAD') AS [2004]
ON
STU.STUDENT_GU = [2004].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('A1A45208-69FC-4E58-99B3-7501E9108D70') AS [2003]
ON
STU.STUDENT_GU = [2003].STUDENT_GU

LEFT JOIN 
APS.LatestPrimaryEnrollmentInYear('3D95815E-93DB-4E7A-9741-4252AB7D1DAA') AS [2002]
ON
STU.STUDENT_GU = [2002].STUDENT_GU


--TEST_NAME NOT IN ('SCREENER', 'WAPT', 'PRE-LAS')
--AND STU.SIS_NUMBER = 970105607

--) AS T1


--)AS T2
--) AS T3
--) AS T4

--LEFT JOIN 
--APS.LCEStudentsAndProvidersAsOf('20170814') AS LCE
--ON
--T4.SIS_NUMBER = LCE.SIS_NUMBER


--LEFT JOIN 
--(
--SELECT *  FROM(
--SELECT 
--stu.SIS_NUMBER
--,ROW_NUMBER() OVER (PARTITION BY ell.STUDENT_GU ORDER BY ENTRY_DATE DESC) AS RN
--,ELL.ENTRY_DATE
--,ELL.EXIT_DATE
--,ELL.EXIT_REASON
-- FROM 
--rev.EPC_STU_PGM_ELL_HIS as ell
--INNER JOIN 
--rev.epc_stu as stu
--on
--ell.STUDENT_GU = stu.STUDENT_GU

--) AS T1
--WHERE 
--RN = 1
--) AS HISTORY

--ON
--HISTORY.SIS_NUMBER = T4.SIS_NUMBER

--LEFT JOIN 
--(SELECT 
--	*
	
--	FROM
--            OPENROWSET (
--                  'Microsoft.ACE.OLEDB.12.0', 
--                 'Text;Database=\\SYNTEMPSSIS\Files\TempQuery;',
--                  'SELECT * from ELLREMOVE.txt'
--                ) AS [T1]

--) AS REMOVEME
--ON
--REMOVEME.SIS_NUMBER = T4.SIS_NUMBER


--WHERE REMOVEME.SIS_NUMBER IS NULL

--) AS ONLYLCE

	
REVERT
GO