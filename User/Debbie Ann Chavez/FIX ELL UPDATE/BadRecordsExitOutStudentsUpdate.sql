
BEGIN TRAN

UPDATE REV.EPC_STU_PGM_ELL
SET EXIT_REASON = WHAT
, PROGRAM_CODE = NULL
, PROGRAM_QUALIFICATION = NULL
, PARTICIPATION_STATUS = NULL 

FROM
(
SELECT SIS_NUMBER,HIST.STUDENT_GU, ENTRY_DATE, PROGRAM_CODE, EXIT_DATE, EXIT_REASON, 
	CASE  
		WHEN EXIT_DATE BETWEEN '20010701' AND '20020630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20020701' AND '20030630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20030701' AND '20040630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20040701' AND '20050630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20050701' AND '20060630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20060701' AND '20070630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20070701' AND '20080630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20080701' AND '20090630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20090701' AND '20100630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20100701' AND '20110630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20110701' AND '20120630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20120701' AND '20130630' THEN 'EY5'
		WHEN EXIT_DATE BETWEEN '20130701' AND '20140630' THEN 'EY4'
		WHEN EXIT_DATE BETWEEN '20140701' AND '20150630' THEN 'EY3'
		WHEN EXIT_DATE BETWEEN '20150701' AND '20160630' THEN 'EY2'
		WHEN EXIT_DATE BETWEEN '20160701' AND '20170630' THEN 'EY1'
ELSE '' END AS WHAT
--,HIST.STU_PGM_ELL_HIS_GU

FROM 
REV.EPC_STU_PGM_ELL AS HIST
INNER JOIN 
REV.EPC_STU AS STU
ON
HIST.STUDENT_GU = STU.STUDENT_GU
WHERE
EXIT_DATE IS NOT NULL 
AND EXIT_REASON  IS NULL
AND PROGRAM_CODE = 1
) AS BADRECORDS

WHERE 
REV.EPC_STU_PGM_ELL.STUDENT_GU = BADRECORDS.STUDENT_GU

--ORDER BY EXIT_DATE

COMMIT