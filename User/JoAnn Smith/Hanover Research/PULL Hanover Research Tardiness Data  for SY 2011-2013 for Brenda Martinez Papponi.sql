--SCHOOL YEAR IN SCHOOL MAX
--2012 FOR 2011
--2013 FOR 2012
--2014 FOR 2013

WITH TARDYCTE(SISNUMBER, SCHOOLCODE, CALDT, TARDYCT)
AS
(
select
    ID_NBR,
	SCH_NBR,
	CAL_DT,
	count(CAL_DT) as TARDYCT
from
	DBTSIS.AT030_V
where
	DST_NBR = 1
and
	SCH_YR = 2014
and
	SCH_NBR = '520'
and
	ATT_STAT = 'T'
--AND
--	ID_NBR = 96381
GROUP BY
	ID_NBR, SCH_NBR, CAL_DT

)

SELECT
	TAR.SISNUMBER,
	TAR.SCHOOLCODE,
	SUM(TARDYCT) AS [TOTAL TARDIES]
from
	TARDYCTE TAR
GROUP BY
	TAR.SISNUMBER, 
	TAR.SCHOOLCODE
ORDER BY
	TAR.SISNUMBER




